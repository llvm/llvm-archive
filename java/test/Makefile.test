##==-- test/Makefile.test - Common make rules Java tests -*- makefile -*--====##
#
#                     The LLVM Compiler Infrastructure
#
# This file was developed by the LLVM research group and is distributed under
# the University of Illinois Open Source License. See LICENSE.TXT for details.
#
##===----------------------------------------------------------------------===##

include $(LEVEL)/Makefile.common

ifdef BUILD_JAVA_SOURCE
all:: .class-stamp
.class-stamp: $(shell find . -name '*.java')
	$(JAVAC) $?
	touch .class-stamp
endif

.PHONY: clean

clean::
	$(RM) -f a.out core
	$(RM) -rf Output/

# we don't want these files to be deleted by make, even if they are
# intermediate results
.PRECIOUS: Output/.dir Output/%.bc Output/%.ll Output/%.llvm.bc Output/%.llvm

# rule to build raw bytecode from a classfile
Output/%.raw.bc: %.class Output/.dir $(CLASS2LLVM)
	$(CLASS2LLVM) $* | $(LOPT) -mem2reg > $@

#rule to link in runtime to raw bytecode
Output/%.linked.bc: Output/%.raw.bc $(BUILD_SRC_ROOT)/runtime/runtime.bc
	$(LLVMTOOLCURRENT)/llvm-link$(EXEEXT) $^ -o $@
